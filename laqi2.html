<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <title>在线支付 - 支付宝 - 网上支付 安全快速！</title>
    <link rel="stylesheet" href="css/start.css">
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"/>
    <script src="css/layer.js"></script>
</head>
<body>
<div>
    <div class="header">
        <img src="http://mb.7gowan.com/run/gateway/view/static/css/dingding/alipay_full_logo.png">
    </div>
    <div class="order">
        <div class="no">
            <label>订单号:</label>
            <span>57582019050248545599</span>
        </div>
        <h3>
            200.00            <small>元</small>
        </h3>
        <p class="countdown">倒计时</p>
        <div class="warn">
            <p>如果不能直接拉起支付</p>
            <p>请点击按钮支付</p>
        </div>
        <!--<button onclick="pay1()">去支付 【1】</button>-->
        <button onclick="pay2()">去支付</button>
    </div>
</div>
<script>
    var ua = navigator.userAgent.toLowerCase();
    var isAndroid = /android|adr/.test(ua) && !(/windows phone/.test(ua));

    //替换下边的dataString即可（换成动态的）
    var data = {"requestType": "SafePay", "fromAppUrlScheme": "alipays", "dataString": 'alipay_sdk=alipay-sdk-java-3.5.35.DEV&app_id=2018101061618854&biz_content=7UyROpIwNDbETBJrNdfXuutjfKDfqQVc5wAB1wHdeQWttRMj8EnIXx74dRUO7eE1jDoQARR9Br4VkWJRygQRUrHAeCMazMTCv8D7BRla69JGuz6R%2FDMb8QomB%2F9nED8Y4XGa%2FIIxwVF1YgFi8W4%2FPAogw2%2BWPBiwb%2FwWTOf6YSPsEmtCUCJ6wMzbAua0NTpKw%2F920gqe6w6%2FaI2W35f7tFfNX%2B71xmInxAvFArnEb9YpUUdjZZW%2BSLVc3yfJuGTQAhaxwp4PuaDDYgax%2FfVyeTc7QPV57uElu3bhHklDGHJm8tYJrmwX3VejA%2BHRPskTsLhXqBGERup3%2FXi3M2%2BbrLlX5hYxWRXpXfTqFL%2BvI3h08i6PtbmUGi0y3M62qlhTZopVflpSYxDcgv8pHcwR%2F9z2a%2FPogXWiVusk%2FX1VDYQl%2F25X6FtE2l6D1iCuYuwvisFikhgcbH1jQaLYW%2BnQaSX9WcFrB2W%2BDbcIDt45fp522DvNuMYLHxqUExT3hMSGqy9%2FpYamqnhgphIje%2BGllrcC85q6u1wDgKnt8lretIzhQORKrBt8cBL58TGTXLtNVWkL%2FP5gTdvDqWyuJ6N9fUjgHXt3Kj4NU8lwV72aHqL5yepzOQP8vKfVWd7pJy6c%2FyMWOu3HnTynXLRrPKnQ5Ls6bVGoYAT2iV2Tz9P2DuKCxOYMUrVDr%2B01qnD31RhfQ3pHwVTYLGa9wiW3Nc32Otafw%2F6j9dw1rAfTe2%2Bz3SRpbHzxzj77aS1GIC%2Fh%2Fa0OPUWmftbNAwJajF%2BDQD2dxJ5ngE5U9FuLDvrFt2KipJANbg8k2va2u1sXdBu5SCivZWW%2FB6TMdD%2BNnuHkrDq7lphCpVsN5gpQuGZr7hcSfuHjJSv%2F9NBsVNw2groLla72CJ7xlM9dP3lJvlSMGokvDPEclWIS4G6zVwZuIrJBYR6%2BPtUJGQUJgrsa7Q4wJQgUNIfjxBk1C3J4B2z3KjSBWyFlo8bhCntXCNKQ1Dtc1qiF7sZF2oA85n9gvx1I3%2FRy%2FkkD8RKb8kprUFMwX5HZct%2BwakPCZx2hTa8P9ArlWM9Ar4TCCKI7IuAqw4sBybrw76LEuhnFSERC9%2FbKVLzT01GjD%2B3ApLKErXIiIJu4x7T6dkJi4gIa8qhFxqsb1FSJt1PXnBpLqmXNficHxpMZ1eHjNs%2FU98VlrSajYay6iJCM97vWynkR1dzj1yaOV13Z7%2Fgg6NQjuU4buMMkhod2mcKriHpWu%2FHWTVGmuGOicWX2BFvSGLEqR4xK2bnelOMu3lgSHw06evugVeGBgRbkQCa10dcn3QYGQoe38g5XKJDYkc8guK9ps2lUE%2B4vOx3XmASTz5LBhQfqznTiwv29CjRfqBBaMnSyrRdTRZeMSVQ2uy39AnfJy18LjOFiBoGJCuFCmE5Rs%2F0%2B4Z9tzBhrtNuYskw9a%2BkAfuHdMNmV3THEjegtHO3GwqrJv2M%2F%2Fo42PXdAltAVW%2FQw6hKXDGRJdkzR5hbZQq82tOdAqrUxWftf7%2B%2BixEB9lzXKpHYcabxc&charset=UTF-8&encrypt_type=AES&format=json&method=alipay.fund.trans.app.pay&sign=aZ%2F6MoXUHCkopdMRxn7M8TofpiWX09J9MjfQN5HQvRQWw8%2FfHoCsvMYXfHwuTzCp%2Fe2pmpryGPdP39SrjXQDBwtOfXtQAis6cSiaSsjYEyYIYZ69lBo6L1hW1dakkrF%2ByyyL10Y3ikyAjy5pO%2B4IRoIMG4jCYL27CRCKVeca2gvRUGa4OTkfODGDDmZ9Ghr8KxLtPrugsERH3ZN00j91wbDvAu1cglocB15HpOjjOlE5qy9%2BI%2FyCuH5o7B%2B6RWbO2hP%2F3nOkVbw1u3OxlXPX0DIXvjYmos%2BY25PGGve2sqdOYX7ACptNKZI%2BAag89%2BIHdx%2B4YuZMEmJoOfbyhOoW7Q%3D%3D&sign_type=RSA2&timestamp=2019-05-06+10%3A38%3A33&version=1.0'};

    var o = {
        'ios': encodeURIComponent(JSON.stringify(data)),
        'android': encodeURIComponent(data.dataString)
    };

    $(function () {

        //倒计时
        countdown();

        //订单监控
        monitor();

        //自动吊起支付
        setTimeout(function () {
            pay1();
        }, 100)

        AlipayJSBridge.call("setTitle", {
            title: "支付宝帐单",
            subtitle: "安全支付"
        });
        AlipayJSBridge.call("setOptionMenu", {
            icontype: "filter",
            redDot: "1" // -1表示不显示，0表示显示红点，1-99表示在红点上显示的数字
        });
        AlipayJSBridge.call("hideOptionMenu");

    });

    function customClickEvent() {
        var clickEvt;
        if (window.CustomEvent) {
            clickEvt = new window.CustomEvent('click', {
                canBubble: true,
                cancelable: true
            });
        } else {
            clickEvt = document.createEvent('Event');
            clickEvt.initEvent('click', true, true);
        }
        return clickEvt;
    }


    //支付方式1
    function pay1() {


        if (isAndroid) {
            var alipaysUrl = 'alipays://platformapi/startApp?appId=20000125&orderSuffix=' + o.android + '#Intent;scheme=alipays;package=com.eg.android.AlipayGphone;end';
        }
        //fix for iOS QQ browser
        else if (ua.indexOf('mqqbrowser') > -1) {
            var alipaysUrl = 'alipay://alipayclient/?' + o.android;
        }
        else {
            var alipaysUrl = 'alipay://alipayclient/?' + o.ios;
        }

        if (isAndroid) {
            var ul = "taobao://render.alipay.com/p/s/i?scheme=";
            var taourl = ul + encodeURIComponent(alipaysUrl);
            // AlipayJSBridge.call('pushWindow', { url: taourl })
            AlipayJSBridge.call('pushWindow', { url: alipaysUrl })
        } else {
            AlipayJSBridge.call('pushWindow', { url: alipaysUrl })
        }

    }

    //支付方式2
    function pay2() {

        if (isAndroid) {
            var alipaysUrl = 'alipays://platformapi/startApp?appId=20000125&orderSuffix=' + o.android + '#Intent;scheme=alipays;package=com.eg.android.AlipayGphone;end';
        }
        //fix for iOS QQ browser
        else if (ua.indexOf('mqqbrowser') > -1) {
            var alipaysUrl = 'alipay://alipayclient/?' + o.android;
        }
        else {
            var alipaysUrl = 'alipay://alipayclient/?' + o.ios;
        }

        if (isAndroid) {
            var openSchemeLink = document.getElementById('openSchemeLink');
            if (!openSchemeLink) {
                openSchemeLink = document.createElement('a');
                openSchemeLink.id = 'openSchemeLink';
                openSchemeLink.style.display = 'none';
                document.body.appendChild(openSchemeLink);
            }

            //openSchemeLink.href = alipaysUrl;
            // oppo浏览器兼容写法
            openSchemeLink.onclick = function () {
                window.location.href = alipaysUrl;
            };

            // trigger click
            openSchemeLink.dispatchEvent(customClickEvent());

        } else {
            var ifr = document.createElement('iframe');
            ifr.src = alipaysUrl;
            ifr.style.display = 'none';
            document.body.appendChild(ifr);
        }

    }

    //倒计时
    function countdown() {
        var intDiff = parseInt('193');//倒计时总秒数量
        var interval = setInterval(function () {
            var day = 0,
                hour = 0,
                minute = 0,
                second = 0;//时间默认值
            if (intDiff > 0) {
                day = Math.floor(intDiff / (60 * 60 * 24));
                hour = Math.floor(intDiff / (60 * 60)) - (day * 24);
                minute = Math.floor(intDiff / 60) - (day * 24 * 60) - (hour * 60);
                second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
            }

            if (minute <= 9) minute = '0' + minute;
            if (second <= 9) second = '0' + second;

            $('.countdown').text(hour + '时' + minute + '分' + second + '秒');
            intDiff--;

            if (intDiff <= 0) {
                clearInterval(interval)
                layer.confirm('当前订单已经过期,请重新发起支付', {
                    icon: 2,
                    title: '订单超时',
                    btn: ['确认'] //按钮
                }, function () {
                    location.href = "https://mer.jspay.ml/return/JSP3B9BA3C8E4A769075C814142323";
                });
            }

        }, 1000);
    }

    //查询订单
    function monitor() {

        var interval = setInterval(function () {
            $.get("http://mb.7gowan.com/gateway/pay/NewPayQueryRed.do?orderstr=0&out_trade_no=JSP3B9BA3C8E4A769075C814142323", function (result) {
                //成功
                if (result.code == '200') {
                    clearInterval(interval);
                    layer.confirm(result.msg, {
                        icon: 1,
                        title: '支付成功',
                        btn: ['我知道了'] //按钮
                    }, function () {
                        location.href = "https://mer.jspay.ml/return/JSP3B9BA3C8E4A769075C814142323";
                    });
                }

                //订单已经超时
                if (result.code == '-1' || result.code == '-2') {
                    clearInterval(interval);
                    layer.confirm(result.msg, {
                        icon: 2,
                        title: '支付失败',
                        btn: ['确认'] //按钮
                    }, function () {
                        location.href = "https://mer.jspay.ml/return/JSP3B9BA3C8E4A769075C814142323";
                    });
                }
            });
        }, 1000);


    }

</script>

</body>

</html>
