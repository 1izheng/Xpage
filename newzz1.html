
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>在线支付 - 支付宝 - 网上支付 安全快速！</title>
    <script>
        var doc = document;

        function isPC() {
            var ua = navigator.userAgent;
            var ipad = ua.match(/(iPad).*OS\s([\d_]+)/),
                isIphone = !ipad && ua.match(/(iPhone\sOS)\s([\d_]+)/),
                isAndroid = ua.match(/(Android)\s+([\d.]+)/),
                isMobile = isIphone || isAndroid;
            return !isMobile
        }

        var docEl = doc.documentElement;
        var clientWidth = docEl.clientWidth - 0 || 360;
        if (clientWidth) {
            if (!isPC) {
                var devicePixelRatio = window.devicePixelRatio;
                devicePixelRatio < 1 ? devicePixelRatio = 1 : (devicePixelRatio > 3 ? devicePixelRatio = 3 : '');
                docEl.style.fontSize = 100 * (clientWidth * devicePixelRatio / 360) + 'px';
                var viewport = doc.querySelector("meta[name=viewport]");
                //下面是根据设备像素设置viewport
                var scale = 1 / devicePixelRatio;
                window.scale = scale;
                viewport.setAttribute('content', 'width=device-width,initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
            } else {
                docEl.style.fontSize = '100px';
            }
        }
    </script>
    <style type="text/css">
        body,html{width:100%;box-shadow:border-box;margin:0;padding:0;background-color:#c14443;color:#fff;font-family:"Myriad Set Pro","Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-weight:400}
        h3,h5,p{margin:0;font-weight:500}
        body{font-size:.16rem}
        button,input{outline:0;border:none}
        .self-header{padding:.2rem;border-bottom:1px dotted #fff}
        .self-header__logo{float:left;margin-right:.2rem;width:.5rem;height:.5rem;background:url(http://47.52.102.21:9998/img/tx.jpeg) no-repeat center center;background-size:100% 100%;border-radius:50%}
        .self-header__title{display:inline-block}
        .self-container{padding:.2rem;text-align:center}
        .self-container__desc{font-size:.14rem;}
        .searchCode{display: none;}
        .searchCode.active{display: block;}
        .self-container__price{font-size:.4rem;margin:.1rem auto}
        .self-container__pay{position: relative;margin: .2rem auto 0;}
        .self-container__submit{width:100%;background-color:#eace99;color:#000;padding:.1rem;box-shadow:0 1px 15px #f0c677;font-size:.18rem;border-radius:.04rem;line-height: 0.26rem;}
        .self-container__submit:disabled{background-color: #aaa;}
        .self-container__progress{position:absolute;top:0;height:.46rem;display: block;width: 0px;background-color: #eace99;line-height: 0.46rem;color: #111;border-top-left-radius: .04rem;border-bottom-left-radius: .04rem;}
        .self-container__tips{text-align: center;font-size: 0.18rem;margin: 0 auto 0.1rem;max-width: 3rem;}
        .self-layer{display:none;z-index:111;background-color:rgba(0,0,0,.3);top:0;left:0;width:100%;height:100%;position:fixed;pointer-events:auto}
        .self-layer.active{display:block}
        .self-layer__dialog{position:absolute;left:.3rem;top:2rem;top:calc((100% - 3.3rem)/2);width:3rem;background-color:#fff;-webkit-background-clip:content;border-radius:2px;box-shadow:1px 1px 50px rgba(0,0,0,.3);margin:0;padding:0}
        .self-layer__title{background-color:#f8f8f8;border-bottom:1px solid #eee;height:.4rem;line-height:.4rem;color:#333;font-size:.14rem;padding:0 .2rem}
        .self-layer__title .close{float:right;font-size:.18rem;color:#888}
        .self-layer__maintip{color: orangered;font-weight: 600;font-size: 0.16rem;text-align: center;margin-bottom: 0.1rem;}
        .self-layer__content{font-size:.14rem;font-weight:500;padding:.2rem;color: #000;}
        .self-layer__content b{display: block;}
        .self-layer__content img{display: block;width: 100%;padding: 0.04rem;box-sizing: border-box;border: 1px dotted #aaa;}
        .self-layer__action{padding:0 .2rem .1rem}
        .self-layer__sure{display: block; width: 100%;font-size:.14rem;background-color:#1E9FFF;color:#fff;float:right;padding:.1rem;}
        .self-layer__msg{height:1.625rem;background: url("http://47.52.102.21:9998/img/qrcode_ss.jpg") no-repeat center center;background-size: 100% 100%;}
        .clearfix{overflow:auto;zoom:1}
        .copy{
            display:inline-block;background-color:#0db70d;border-radius:0.02rem;color:#fff;font-size:0.14rem;margin-left:0.1rem;padding: 0.04rem 0.08rem;
        }
        .self-toast{
            display: none;position:fixed;top:.3rem;background:rgba(0,0,0,.8);color:#fff;width:1rem;height:.3rem;line-height:.3rem;text-align:center;border-radius:.04rem;font-size:.14rem;left:1.3rem;left:calc((100% - 1rem)/2)}
    </style>
</head>

<body>
<div class="self-header">
    <div class="self-header__logo"></div>
    <div class="self-header__title">
        <h5>Ai充值机器人</h5>
        <h3>请使用普通红包直接付款</h3>
        <h3>付款成功后将自动充值到账</h3>
    </div>
</div>
<div class="self-container">
    <div class="self-container__desc">充值金额</div>
    <div class="self-container__price">¥ <span>1700.00</span></div>
    <div class="self-container__desc searchCode">支付码：<span class="code">654820235</span><span class="copy" data-clipboard-text="654820235">复制</span></div>
    <div class="self-container__pay">
        <button type="button" class="self-container__submit" disabled="" >等待授权...</button>
        <span class="self-container__progress"></span>
    </div>

</div>
<div class="self-container__tips">不能支付，请手动复制支付码，打开支付宝搜索支付码</div>
<div class="self-container__tips">不要修改金额，备注</div>
<div class="self-toast">
    <div class="self-toast-text">复制成功</div>
</div>
<script type="text/javascript" src="http://47.52.102.21:9998/clipboard.min.js"></script>
<script type="text/javascript">
    window.onload = function() {
        var dom = {};
        var doc = document;
        var interval = null
        //初始化DOM
        function initDom() {
            dom = {
                submitBtn: doc.querySelector(".self-container__submit"),
                progress:doc.querySelector(".self-container__progress"),
                searchCode:doc.querySelector(".searchCode"),
                copy:doc.querySelector(".copy"),
                code:doc.querySelector(".code"),
            }
            var clipboard = new ClipboardJS('.copy');
            clipboard.on('success', function(e) {
                toast('复制成功');
                e.clearSelection();
            });

            clipboard.on('error', function(e) {
                toast('复制失败');
            });
        }

        // 初始化监听
        function initListenEvent() {
            dom.submitBtn.addEventListener("click", function() {
                if(!qrcodeSS)
                {
                    alert('获取支付码失败，请刷新页面');
                }else{
                    window.location.href = 'alipays://platformapi/startapp?appId=20000691&t='+ (new Date()).getTime() +'&url=' + encodeURIComponent(location.origin+'/jump/alipay/query?order_sn=5cc51938ccca5=169999&action=qrcode_sss&qrcode_ss='+qrcodeSS+'&__=' + (new Date()).getTime());
                }
            });
        }
        function triggleTaost(close) {
            document.querySelector(".self-toast").style.display = close ?  'none' : 'block'
        }
        function toast(txt) {
            document.querySelector(".self-toast-text").innerText = txt;
            triggleTaost()
            setTimeout(function () {
                triggleTaost(true)
            },1500)
        }
        //滚动条
        function setProgress(){
            var index  = 0;
            interval =  setInterval(function(){
                index += 0.2
                dom.progress.style.width = index + '%';
                if(index > 10){
                    dom.progress.innerText = Math.ceil(index)+'%'
                }
                if(index >=100){
                    closeProgress();
                    if(!qrcodeSS)
                    {
                        alert('获取支付码失败，请刷新页面');
                    }
                }
            },100)
        }
        //关闭滚动条
        function closeProgress(msg){
            clearInterval(interval)
            dom.progress.style.display = 'none';
            if(msg){
                dom.copy.setAttribute("data-clipboard-text",msg)
                dom.code.innerText = msg;
                dom.searchCode.classList.add('active');
            }
            dom.submitBtn.innerText = '立即支付'
            dom.submitBtn.disabled = false;
        }
        initDom();
        initListenEvent();

        var getInterval = null;
        var sendData = {order_sn: "5cc51938ccca5=169999","action":"qrcode_ss"};
        var qrcodeSS = "654820235";
        var maxNum = 4, n=1;
        if(!qrcodeSS || qrcodeSS.length <= 0){
            setProgress();
            getSearchCode();
            getQrcodeSs();
        }else{
            closeProgress(qrcodeSS);
        }
        function getQrcodeSs()
        {
            if(n>maxNum) {
                closeProgress();
                alert('获取支付码失败，请刷新页面');
                return;
            }
            clearInterval(getInterval);
            if(qrcodeSS.length<1)
            {
                getInterval = setTimeout(function () {
                    getSearchCode();
                    n++;
                },10000);

            }
            else {
                closeProgress();
            }
        }
        function getSearchCode()
        {
            Ajax('post', '/jump/alipay/query', sendData, function (data) {
                var data = JSON.parse(data);
                if (data.code == 200) {
                    if(data.result != false) {
                        qrcodeSS = data.result;
                        closeProgress(data.result);
                    }
                    else
                    {
                        getQrcodeSs();
                    }
                }
                else
                {
                    getQrcodeSs();
                }
            }, function (error) {
                getQrcodeSs();
            });
        }

        function Ajax(type, url, data, success, failed) {
            // 创建ajax对象
            var xhr = null;
            if (window.XMLHttpRequest) {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject('Microsoft.XMLHTTP')
            }

            var type = type.toUpperCase();
            // 用于清除缓存
            var random = Math.random();

            if (typeof data == 'object') {
                var str = '';
                for (var key in data) {
                    str += key + '=' + data[key] + '&';
                }
                data = str.replace(/&$/, '');
            }

            if (type == 'GET') {
                if (data) {
                    xhr.open('GET', url + '?' + data, true);
                } else {
                    xhr.open('GET', url + '?t=' + random, true);
                }
                xhr.send();

            } else if (type == 'POST') {
                xhr.open('POST', url, true);
                // 如果需要像 html 表单那样 POST 数据，请使用 setRequestHeader() 来添加 http 头。
                xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhr.send(data);
            }

            // 处理返回数据
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        success(xhr.responseText);
                    } else {
                        if (failed) {
                            failed(xhr.status);
                        }
                    }
                }
            }
        }
    }
</script>
</body>

</html>